name: Playwright Smoke (basic)

on:
  push:
    branches: [ main, 'feature/**' ]
  pull_request:
  workflow_dispatch: {}

jobs:
  upload-artifacts:
    name: Upload Playwright artifacts (basic)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Normalize smoke-result.json URLs
        env:
          URL: 'http://localhost:1420/'
        run: |
          node -e "const fs=require('fs'),path=require('path');const root='builds';const url=process.env.URL||'http://localhost:1420/';function walk(d){if(!fs.existsSync(d))return;for(const e of fs.readdirSync(d)){const p=path.join(d,e);const s=fs.statSync(p);if(s.isDirectory())walk(p);else if(e==='smoke-result.json'){try{const j=JSON.parse(fs.readFileSync(p,'utf8'));j.url=url;fs.writeFileSync(p,JSON.stringify(j,null,2));console.log('Patched',p);}catch(err){fs.writeFileSync(p,JSON.stringify({url:url},null,2));console.log('Rewrote',p);}}}};walk(root);"
      - name: Upload artifacts
        if: ${{ always() }}
        uses: actions/upload-artifact@v4
        with:
          name: playwright-artifacts
          path: |
            builds/**
            dist/index.html
